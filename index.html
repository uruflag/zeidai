<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ğŸ”¥ åˆæ ¼ã¸ã®ç·´ç¿’å•é¡Œã‚µã‚¤ãƒˆ</title>

<style>
    body {
        font-family: "Yu Gothic", sans-serif;
        background: #fff8f0;
        margin: 0;
        padding: 0;
        text-align: center;
        overflow-x: hidden;
    }

    header {
        background: linear-gradient(90deg, #ff4d4d, #ff9900);
        color: white;
        padding: 20px;
        font-size: 28px;
        font-weight: bold;
        letter-spacing: 2px;
    }

    /* â˜… container ã®å·¦å³ä½™ç™½ã‚¼ãƒ­ï¼ˆã‚ºãƒ¬é˜²æ­¢ï¼‰ */
    #container {
        width: 100%;
        max-width: 700px;
        margin: 0 auto;
        padding: 0;
        box-sizing: border-box;
        background: white;
        border-radius: 10px;
        display: none;
    }

    .inner {
        padding: 20px;
        box-sizing: border-box;
        text-align: center;
    }

    .choice {
        background: #f7f7f7;
        padding: 12px;
        margin: 10px 0;
        border-radius: 8px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: 0.2s;
        width: 100%;
        box-sizing: border-box;
        text-align: left;
    }

    .choice:hover {
        border: 2px solid #ff9900;
        background: #fff3e0;
    }

    #resultBox {
        margin-top: 20px;
        padding: 15px;
        background: #fff0e6;
        border-left: 5px solid #ff6600;
        display: none;
        text-align: left;
        width: 100%;
        box-sizing: border-box;
    }

    button {
        padding: 10px 20px;
        margin: 15px 10px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background: #ff6600;
        color: white;
        font-weight: bold;
    }

    button:hover {
        background: #ff3300;
    }

    #scoreBox {
        margin-top: 20px;
        font-size: 20px;
        font-weight: bold;
        color: #cc0000;
    }

    /* â–¼ ã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ â–¼ */
    @media screen and (max-width: 600px) {

        header {
            font-size: 22px;
            padding: 15px;
        }

        #container {
            width: 100%;
            margin: 0 auto;
            padding: 0;
            box-sizing: border-box;
        }

        .inner {
            padding: 15px;
        }

        .choice,
        #resultBox {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            margin: 8px 0;
            font-size: 18px;
            padding: 14px;
        }

        #questionCountInput {
            width: 80%;
            font-size: 20px;
        }
    }
</style>
</head>

<body>

<header>ğŸ”¥ åˆæ ¼ã¸ã®ç·´ç¿’å•é¡Œ2 ğŸ”¥</header>

<!-- â–¼ ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠç”»é¢ â–¼ -->
<div id="categorySelect" style="margin-top:30px;">
    <h2>ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠ</h2>
    <div id="categoryButtons"></div>
</div>

<!-- â–¼ å•é¡Œæ•°å…¥åŠ›ç”»é¢ â–¼ -->
<div id="questionCountSelect" style="display:none; margin-top:30px;">
    <h2>å•é¡Œæ•°ã‚’å…¥åŠ›</h2>
    <input id="questionCountInput" type="number" min="1" placeholder="ä¾‹ï¼š5"
           style="padding:10px; font-size:18px; width:150px;">
    <br><br>
    <button onclick="startQuizWithCustomCount()">é–‹å§‹ã™ã‚‹</button>
</div>

<!-- â–¼ ã‚¯ã‚¤ã‚ºç”»é¢ â–¼ -->
<div id="container">
    <div class="inner">
        <h2 id="categoryTitle"></h2>
        <h3 id="questionText"></h3>

        <div id="choices"></div>

        <div id="resultBox"></div>

        <button onclick="prevQuestion()">å‰ã®å•é¡Œ</button>
        <button onclick="nextQuestion()">æ¬¡ã®å•é¡Œ</button>
        <button onclick="showScore()">æˆç¸¾</button>

        <br><br>

        <button onclick="goToCategory()">æŒ‘æˆ¦é–‹å§‹ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¼ã¸æˆ»ã‚‹ï¼‰</button>

        <div id="scoreBox"></div>
    </div>
</div>

<script>
let allQuestions = [];
let currentCategory = "";
let quizList = [];
let index = 0;
let correctCount = 0;

/* â–¼ TSV èª­ã¿è¾¼ã¿ â–¼ */
fetch("questions.tsv")
    .then(res => res.text())
    .then(text => {
        allQuestions = parseTSV(text);
        createCategoryButtons();
    });

/* â–¼ TSV ãƒ‘ãƒ¼ã‚¹ï¼ˆæ­£è§£ç•ªå·ã«å¯¾å¿œï¼‰ â–¼ */
function parseTSV(text) {
    const lines = text.trim().split("\n");
    const data = [];

    for (let i = 1; i < lines.length; i++) {
        const [category, q, a1, a2, a3, a4, correct, explain] = lines[i].split("\t");

        data.push({
            category,
            question: q,
            choices: [a1, a2, a3, a4],
            correctIndex: Number(correct) - 1, // â˜… 1ã€œ4 â†’ 0ã€œ3
            explain
        });
    }
    return data;
}

/* â–¼ ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒœã‚¿ãƒ³ç”Ÿæˆ â–¼ */
function createCategoryButtons() {
    const area = document.getElementById("categoryButtons");
    area.innerHTML = "";

    const categories = [...new Set(allQuestions.map(q => q.category))];

    categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.onclick = () => startCategory(cat);
        area.appendChild(btn);
    });

    const totalBtn = document.createElement("button");
    totalBtn.textContent = "ç·åˆï¼ˆå…¨ã‚«ãƒ†ã‚´ãƒªï¼‰";
    totalBtn.onclick = () => startCategory("ç·åˆ");
    area.appendChild(totalBtn);
}

/* â–¼ ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠå¾Œ â–¼ */
function startCategory(cat) {
    currentCategory = cat;

    document.getElementById("categorySelect").style.display = "none";
    document.getElementById("questionCountSelect").style.display = "block";
}

/* â–¼ ã‚·ãƒ£ãƒƒãƒ•ãƒ« â–¼ */
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

/* â–¼ å•é¡Œæ•°å…¥åŠ›å¾Œã«é–‹å§‹ â–¼ */
function startQuizWithCustomCount() {
    const input = document.getElementById("questionCountInput").value;
    let count = parseInt(input);

    if (!count || count <= 0) {
        alert("1ä»¥ä¸Šã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
    }

    let list;
    if (currentCategory === "ç·åˆ") {
        list = [...allQuestions];
    } else {
        list = allQuestions.filter(q => q.category === currentCategory);
    }

    list = shuffle(list);

    if (count > list.length) {
        count = list.length;
        alert("å•é¡Œæ•°ãŒå¤šã™ãã‚‹ãŸã‚ã€æœ€å¤§ã® " + list.length + "å•ã«è¨­å®šã—ã¾ã—ãŸã€‚");
    }

    quizList = list.slice(0, count);

    index = 0;
    correctCount = 0;

    document.getElementById("questionCountSelect").style.display = "none";
    document.getElementById("container").style.display = "block";

    showQuestion();
}

/* â–¼ å•é¡Œè¡¨ç¤ºï¼ˆæ­£è§£ç•ªå·å¯¾å¿œç‰ˆï¼‰ â–¼ */
function showQuestion() {
    const q = quizList[index];
    document.getElementById("categoryTitle").textContent = "ã€" + currentCategory + "ã€‘";
    document.getElementById("questionText").textContent = (index + 1) + ". " + q.question;

    // â˜… é¸æŠè‚¢ã«ã€Œæ­£è§£ãƒ•ãƒ©ã‚°ã€ã‚’ä»˜ã‘ã‚‹
    let choiceObjects = q.choices.map((text, i) => ({
        text: text,
        isCorrect: (i === q.correctIndex)
    }));

    // â˜… ãƒ•ãƒ©ã‚°ã”ã¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    choiceObjects = shuffle(choiceObjects);

    const choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";

    choiceObjects.forEach(obj => {
        const div = document.createElement("div");
        div.className = "choice";
        div.textContent = obj.text;
        div.onclick = () => checkAnswer(obj.isCorrect, q);
        choicesDiv.appendChild(div);
    });

    document.getElementById("resultBox").style.display = "none";
}

/* â–¼ è§£ç­”ãƒã‚§ãƒƒã‚¯ï¼ˆæ­£è§£ç•ªå·å¯¾å¿œï¼‰ â–¼ */
function checkAnswer(isCorrect, q) {
    const resultBox = document.getElementById("resultBox");
    resultBox.style.display = "block";

    if (isCorrect) {
        resultBox.innerHTML = "<b>æ­£è§£ï¼</b><br>" + q.explain;
        correctCount++;
    } else {
        const correctText = q.choices[q.correctIndex];
        resultBox.innerHTML =
            "<b>ä¸æ­£è§£â€¦</b><br>æ­£è§£ã¯ã€Œ" + correctText + "ã€<br>" + q.explain;
    }
}

/* â–¼ å‰ã¸ â–¼ */
function prevQuestion() {
    if (index > 0) {
        index--;
        showQuestion();
    }
}

/* â–¼ æ¬¡ã¸ â–¼ */
function nextQuestion() {
    if (index < quizList.length - 1) {
        index++;
        showQuestion();
    }
}

/* â–¼ æˆç¸¾è¡¨ç¤º â–¼ */
function showScore() {
    const scoreBox = document.getElementById("scoreBox");
    const total = quizList.length;
    const rate = Math.round((correctCount / total) * 100);

    let msg = `æ­£è§£æ•°ï¼š${correctCount}/${total}ï¼ˆ${rate}%ï¼‰`;

    if (rate >= 80) {
        msg += "<br>ğŸ”¥ ã“ã®èª¿å­ã§åˆæ ¼ã‚’ã¤ã‹ã‚‚ã†ï¼";
    } else {
        msg += "<br>âš ï¸ åˆæ ¼ãƒ©ã‚¤ãƒ³ 80% ã‚’ã‚­ãƒ¼ãƒ—ã—ã‚ˆã†ï¼";
    }

    scoreBox.innerHTML = msg;
}

/* â–¼ ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¸æˆ»ã‚‹ â–¼ */
function goToCategory() {
    document.getElementById("container").style.display = "none";
    document.getElementById("questionCountSelect").style.display = "none";
    document.getElementById("categorySelect").style.display = "block";

    index = 0;
    correctCount = 0;
    quizList = [];
    document.getElementById("scoreBox").innerHTML = "";
    document.getElementById("resultBox").style.display = "none";
    document.getElementById("questionCountInput").value = "";
}
</script>

</body>
</html>